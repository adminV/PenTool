{"version":3,"file":"penTool.all.js","sources":["../src/constant.ts","../src/cursorConfig.ts","../src/penTool.ts"],"sourcesContent":["const CONST = {\r\n    OBJECT_TYPE: {\r\n        PEN_AUX: \"penAux\",\r\n        CIRCLE: \"circle\",\r\n        LINE: \"line\",\r\n        PATH: \"path\"\r\n    },\r\n    POINT_TYPE: {\r\n        STRAIGHT: \"straight\",\r\n        MIRRORED: \"mirrored\",\r\n        DISJOINTED: \"disjointed\"\r\n    },\r\n    CONTROL_TYPE: {\r\n        LEFT: \"handleA\",\r\n        RIGHT: \"handleB\",\r\n        MAIN: \"main\"\r\n    },\r\n    PATH_STATE: {\r\n        NEW: \"new\"\r\n    },\r\n    CURSOR_TYPE: {\r\n        ADD: 'add',\r\n        NORMAL: 'normal',\r\n        MOVE: 'move',\r\n        CLOSE: 'close',\r\n        DEFAULT: 'default'\r\n    }\r\n}\r\nexport default CONST;","/**\r\n * author Siwei\r\n * 鼠标手势、鼠标位置\r\n */\r\nconst cursorConfig = {\r\n  normal: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAAXNSR0IArs4c6QAABIdJREFUSA3tVWsspFcY/uaW0dgiOqQimQ3iPmkQtyIShlWEbK0uUlGXdkkbTRBtGlIlQmls2B/qkobBH2JIMFHpBE0YGWwRxqWWBl1WMmu2SnXMfDN9zrQz2c5mN4bd/upJTs533vNevue9UnK5/Obk5GTb8fGxB/VfrIGBgZH4+Hh9dXW1cmxsbHR7e/vGq7TLEIvFEq1WK9RoNFqFQvHn7u6uVUpKypK3t3cPdjuDwdC+zB9gEmVWVlbHg4ODzOTk5J8KCgokGxsbzqWlpfe6urruz8/Pf63X621emlGCsKmpaWtiYuKH7OzsJ+vr66kwwENs77W1tSngbrqhoeHB1NSUCPTrVzXMhsv0REloaGje3Nzcj0D0paen5/chISGfwgCXnECc2tjY+N7w8PANqVQ67+bmVu3i4iK/lHGSNAQhEV5YWCiDW9UymayLGMNmG5VubW3dGhkZkWZlZT3u7+9fNdItPU0KiaCfn19NcXFxIpTfnpmZEep0Oo1EIvk5KCjoY0dHRzFYxENDQ8PIZIGlhoz8hqQxXoh7z8/POUggtqur60N3d3cFPOA3Pj4+CLS2hA8njYxmPI3eKH+R04iQQZiVSmVIUVGRd0lJyUB4ePhtQltZWfm8rKys2sPDoxjXChaLRavVavKjHGyLS+ZfCE9PT/knJyfWNjY2poTw9fX9zsvLS3l0dOQKAxSTydShbo0GCcmixTRmKZHi8/kzQPIIKwkuIwio5eXlPGyera3tQ3InCOH2Sxs0uBRGiS4K56/T09OjdXV17+/s7Mz29PQc19bWCtLS0jYDAwO/ITwE4T8uNYaDkC+8DC4FGpIE1kQqLCwsr7y8/C6bzdaiob+RmZkpi4mJeRc/85i8wyANl7IODg7eRl0OtbS0KJaWlj4kbxdZbCcnJ1VzczOfw+Hcn52dlUKoIjg4+AucZD+zuFwuBbTXampqRCqVyprH47HQhZoWFxdZKKvWZwTMCEx0ko/Quirs7Oz+qKqqyq+vr5+Hgm4g5pvxUug4Cfv7++90dnZyfXx8Xj88PGShZCgkFhcyn0GGZy5jfv87eKCCmbW2tnZndXX1g97e3rdQg09iY2PlUPwViv4XxLa5vb092d7e/jW0PnZlZSUF1xr0ZWRkUGgGNMqpPyoqKt3cyNN3U+ARIxoP35IN4VQY/kQkEkX7+/sLYYTC5LBOTExk9vX1UUgmkw60Qgpu1W1ubuppmlabHp7zYUJo/g7EtkA1jPiGCQQC5tnZGaO1tZV4wsCK2FM5OTkUXEpHRkbuC4XCxoCAgLvmeszvzzWIRi1DUw9OSEhgdXd3U3t7eybZ9PR0Cs1Bh4GtKSwsHI+Ojs6Fhx6ZGCz9AIrr+fn556hBvYODg2kje/UYU/q4uDgayB/AYK6luk0xNBP8zdnZWYlafBN0BmqPwliiMD10GMxq1KkkIiLiDlCpzOQuf8VMFCUlJWlQMgZUKH66o6MDibx26/JaXyAJt15D7JbReXS5ubm/4wc6QTN0oxeIXe0JoykOyTOKgRxzNU3/S79CD/wF1bAnj93p/FEAAAAASUVORK5CYII=\",\r\n  add: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAAXNSR0IArs4c6QAABUlJREFUSA29VnkspVcU/96ijxrrvFKVUPveILYiGoxJkUqrOihRW6cyTRpLtYpUiaU0JswfxpImtkSIJbFEZayJJZYpYqfMoMOQZxljGct7+ruv/V4673UmGNOb3Nx3zz3n/L7fueec+6j+/v6POzs7C3d2dvSp/2PU1tY2uru7n6ampvJaWlqaFxYWrr9OXEZNTU3TycmJ6/Hx8cnExMSzpaUlaW9v71EjI6NyzCIGg3FymR/AJM6kpaV36urqmF5eXr9HREQ0zczMqMfGxt4pLS29PzQ09PPp6an8pYEShrm5ufMdHR33goODt6enp30AwMXd3iksLJxAuPnZ2dl/dHd3l0Cu+arAbITslDixs7MLGxwc7AKjHw0MDH6ztbX9BgAcsoKxT05OzmcNDQ3XW1tbh3R0dFK1tLT6LwROkoYwJMbDw8MJCOthb29vKQHDZNNO5+fnP21sbGwNCgraqK6unqTl511FDomhubl5enR0tCec3+jr63MVCATHTU1Ns9bW1rdUVFRqoFJTX1/fgEw2PS8QrS9MGnpDwnt0dCSFBGJra2s/0tPTm0AEzNvb2+vAVoHoYeUjoxn/Zk/bn2WlGTKIMo/Hs42KijKKiYmpdXBwuEFk4+Pj3yckJKTq6+tHY5vEYrH4h4eH5EOlMM9dMs8x3Nvb09jd3ZWVl5cXJYSJicmvhoaGvM3NTW0AUEwmU4C6pQGJ6FyDSWcpsdLQ0OgDk8cYHyFkhAE1NjYWhslVUFB4RPaEIcJ+YUBhSAFKfFFY/+zp6WnOzMwMWFxcHCgvL9/JyMgw9fX1nbOysvqF6BCG/4SUvg4iPvMQhhRsSBLIEit7e/uwxMTE22w2+wQN/WpgYGDvtWvXPsHHbJBzAPIRUtbq6ur7qMv6/Pz8idHR0XBydpbBVlNT28rLy9OQkpK6PzAw0AqjJBsbmx+wkikxOBwOBbZX0tPTS7a2tmS5XC4LXSh3ZGSEhbIqkDAQEzDRSb5E60pSVFTcT0lJ+SorK2sIDsrAWENMl0LH8VhZWfmwuLiYY2xsLLe2tsZCyVBILA5svoMNV9xGfP/35UEKZdbU1NTNycnJLyorK99DDW67ubn1w/FPKPoHuNu8oqIiL2VlZRm0PnZycjKF0Ar9+fv7U2gGfJRTtbOzsx98kYRj4RqeiQOKLh6HfBzeJRPGPgD+uqSkxMXCwsIVIBReDllPT09mVVUVhWQS+UErpBBWwdzc3Cmfzz8kB21tbb37+/tXAawDv8JeTRuIGNICeoWyAlg14H7tTU1NmQcHB4yCggISCaEK7p4KCQmhEFK+k5PTiqura46lpeVtcohX5uH29vZbeOIUAPhccxAxpIHoFT20GU3dxsPDg1VWVkYtLy/TR5Sfnx+F5iDo6uo6joyMbHdxcQmF48cihZf8EJaF+DlYaCLlreCIhWwUgeFJotDmqNnZWYG6uvqDtLS0W2DmAfsnsFGlJ/bCyKF01PEP4h0y0UyEZfcihk/gkIdafJsYo/YoPEsUXg8BHuZD1GmTo6PjTbDaQqK9W1FR0Y9u9CaOpchEXTJJQq2vrz+EvXCYmZnxcM8f/CcgHG3jTbyHLvN5XFwcG+2MwlsoCAgImA0PD0/Efx3yVAmHqqrqFs6fampqHtOyjY0NZXSjN3R1dUVhlpGR2ZeTk+PROhIrwnMFdzeGziMIDQ19ig8ohkwYFgllMQFJGtTzHvQlCEkIaFuw3MXT9G18fHwkGGXjbwXpQq88XghIPKMcWrCQeWnjpYAXRSElg0Qj9ScQ9/FaAJWUlILRKLi4FgnAvwBe6YatAEV1yQAAAABJRU5ErkJggg==\",\r\n  close: \"data:image/png;base64,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\",\r\n  move: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAAXNSR0IArs4c6QAAAstJREFUSA3Nld9rklEYx+cMBX/QTaIIKjkYbqibiOAfINJNNxt6E8KIjIVEUBRBRHTRv2Ajhxde7c4LyboJvIguYhqDyS4G2RxqTRvOWkaSp+/zsgOv+r7h/BEdODzvec7zfT7vec9zzjvDGHN1Op3gzL9qAF7LZrOHjUbjGZ5np84FJOL3+38GAoGjg4ODlxhfmioUgDWfz9cGhBmNxl/5fP49fP6pQZH8utfr/UFA6kqlkiUSid1Wq3VvKlAAb3g8nlMO5DYcDpdrtdoW5vUTBSPhzaWlpe8cJLZ2u/10b2/vLWKcE4Mi2S2n0/lNDBI/q9Vqlk6nP7Tb7bWJQAGMLS4utsQQqedYLLZfr9dfIF49FhgJbjscjhMpSL/P7XYfl0qlN9BcHhkK8Z35+flmf3K5sV6v/53L5ejoXB0JCuHdubm5YzkA9ysUCmYwGJjL5WLBYJAVi8UvuBLvnxd6AYLZbrdLZ7CnRaPRLs5nU6PRnOh0OupNQA9RRPtWq3XXZrN9hOATF+HFtXi+gv4acXTMpBsCH0DcwKxw8Mmur6934/H4c2nFoBc5LpbL5e2VlRVGlsaDUWceTD60WCx1DAVgJBJhGxsbW7KCvgkOW1hYEPRk/wqF4JHZbD4iIL3h5ubmq76cskOCVavVbdxUjM4r5SBLY/LT/IAYzscmk+kzFUIymXw3ECDj4DBYoVUqFQFIljdJKCaf4N78mkqldpBbIZO/xw2NsGfLy8s8N5MC0koHPi8UTzOZzE4oFFL2ZJUZIF5LSWivVCqVACJYoVAQVkiWxtTp84r2lKoYH50xI/rQf3rErtJek3TYTvGkI965G4TCCnH/jrbCcxMhAFTYQ9oj3obew1GApCHoWRUKTCmgZJWOChRDaaVUQPQeZKl6Jw7jL0orpaqlPSWgqCoHDz0XjWs5dKi7dFwY1wOqRV8ly33/hf0D+qqSk3G9oaMAAAAASUVORK5CYII=\"\r\n}\r\n\r\nexport default cursorConfig;\r\n","import CONST from './constant'\r\nimport CURSOR_CONFIG from './cursorConfig'\r\n\r\n/**\r\n * declare Interface of Point \r\n */\r\ninterface IPoint {\r\n    /**\r\n     * X coordinate of point\r\n     */\r\n    x: number,\r\n\r\n    /**\r\n     * X coordinate of point\r\n     */\r\n    y: number\r\n}\r\n\r\n/**\r\n * the curve handler endpoint\r\n */\r\ninterface IController extends IPoint { }\r\n\r\ninterface IPenOptions {\r\n    /**\r\n     * Settings of the aux point\r\n     */\r\n    circle: PenCircle;\r\n\r\n    /**\r\n     * Settings of the aux line\r\n     */\r\n    line: PenLine;\r\n\r\n    /**\r\n     * the stroke color of the pen path\r\n     */\r\n    pathColor: string;\r\n\r\n    /**\r\n     * the fill color of the pen path when the path is closed\r\n     */\r\n    pathFillColor: string;\r\n\r\n    /**\r\n     * Whether need fill the path, when true, fill path with pathFillColor\r\n     */\r\n    isFillPath: boolean;\r\n}\r\n\r\nclass PenObject {\r\n    /**\r\n     * Identify the object as an auxiliary point or line of the path\r\n     * Since js does not support static attributes, \r\n     * this attribute will be used as read-only. Please do not modify during use\r\n     */\r\n    // static penType: string = CONST.OBJECT_TYPE.PEN_AUX;\r\n    penType: string = CONST.OBJECT_TYPE.PEN_AUX;\r\n\r\n    /**\r\n     * The type of drawing object. \r\n     * Since js does not support static attributes, \r\n     * this attribute will be used as read-only. Please do not modify during use\r\n     */\r\n    // static type: string = CONST.OBJECT_TYPE.CIRCLE;\r\n    type: string;\r\n\r\n    /**\r\n     * property of the Canvas 2D API specifies the color, gradient, or pattern \r\n     * to use for the strokes (outlines) around shapes.\r\n     */\r\n    stroke: String | CanvasGradient | CanvasPattern = '#ff56b1';\r\n\r\n    /**\r\n     * property of the Canvas 2D API specifies the color, gradient, or pattern \r\n     * to use inside shapes.\r\n     */\r\n    fill: String | CanvasGradient | CanvasPattern = '#006cff';\r\n\r\n    /**\r\n     * property of the Canvas 2D API sets the thickness of lines.\r\n     */\r\n    lineWidth: number = 1;\r\n\r\n    constructor(options: any = {}) {\r\n        this.penType = CONST.OBJECT_TYPE.PEN_AUX;\r\n        this.stroke = options.stroke || '#ff56b1';\r\n        this.fill = options.fill || '#006cff';\r\n        this.lineWidth = options.lineWidth || 1;\r\n    }\r\n}\r\n\r\n/**\r\n * aux Circle of penTool\r\n */\r\nclass PenCircle extends PenObject {\r\n    /**\r\n     * The x coordinate of the center of the circle\r\n     */\r\n    x: number;\r\n\r\n    /**\r\n     * The y coordinate of the center of the circle\r\n     */\r\n    y: number;\r\n\r\n    /**\r\n     * Radius of Circle\r\n     */\r\n    radius: number = 3;\r\n\r\n    /**\r\n     * name of circle when circle as a handler\r\n     */\r\n    handleName?: string;\r\n\r\n    /**\r\n     * The index of the associated key point when circle as a handler\r\n     */\r\n    keyPointIndex: number;\r\n\r\n    /**\r\n     * property of the Canvas 2D API specifies the color, gradient, or pattern \r\n     * to use for the strokes (outlines) around shapes.\r\n     */\r\n    stroke: String | CanvasGradient | CanvasPattern = '#006cff';\r\n\r\n    /**\r\n     * property of the Canvas 2D API specifies the color, gradient, or pattern \r\n     * to use inside shapes.\r\n     */\r\n    fill: String | CanvasGradient | CanvasPattern = '#fff';\r\n\r\n    constructor(options: any = {}) {\r\n        super(options);\r\n        this.x = options.x;\r\n        this.y = options.y;\r\n        this.radius = options.radius || 3;\r\n        this.keyPointIndex = options.keyPointIndex;\r\n        this.handleName = options.handleName;\r\n        this.fill = options.fill || '#fff';\r\n        this.stroke = options.stroke || '#006cff';\r\n        this.type = CONST.OBJECT_TYPE.CIRCLE;\r\n    }\r\n}\r\n\r\n/**\r\n * aux Line of penTool\r\n */\r\nclass PenLine extends PenObject {\r\n    /**\r\n     * The x coordinate of an endpoint of the line segment\r\n     */\r\n    x1: number;\r\n\r\n    /**\r\n     * The y coordinate of an endpoint of the line segment\r\n     */\r\n    y1: number;\r\n    \r\n    /**\r\n     * The x coordinate of another endpoint of the line segment\r\n     */\r\n    x2: number;\r\n    \r\n    /**\r\n     * The y coordinate of another endpoint of the line segment\r\n     */\r\n    y2: number;\r\n\r\n    constructor(options: any = {}) {\r\n        super(options);\r\n        this.x1 = options.x1;\r\n        this.y1 = options.y1;\r\n        this.x2 = options.x2;\r\n        this.y2 = options.y2;\r\n        this.type = CONST.OBJECT_TYPE.LINE;\r\n    }\r\n}\r\n\r\n/**\r\n * declare path keyPoint Class\r\n */\r\nclass KeyPoint {\r\n    /**\r\n     * svg path key letter. 'M' means moveTo, 'C' means curveTo\r\n     */\r\n    type: string;\r\n\r\n    /**\r\n     * the mousedown keyPoint\r\n     */\r\n    point: IPoint;\r\n\r\n    /**\r\n     * Indicate the relationship between current keyPoint and previous keyPoint\r\n     * 'straight' means drawing a Line from previous to current \r\n     * 'mirrored' means drawing a curve. Cause there will be 2 handlers which are mirror symmetry centered on current keyPoint and in a straight line\r\n     * 'disjointed' means the curve's handlers are not in a straight line\r\n     * @default 'straight'\r\n     */\r\n    pointType: string = CONST.POINT_TYPE.STRAIGHT;\r\n\r\n    /**\r\n     * Coordinates related to the current keyPoint\r\n     * When keyPoint's type is 'M', the array length is 2, the coordinates of the current point are saved\r\n     * When keyPoint's type is 'C', the array length is 6. likes [prevLeft, prevTop, curLeft, curTop, curLeft, curTop]\r\n     */\r\n    relationPoints: number[];\r\n\r\n    /**\r\n     * Index of keyPointData array\r\n     */\r\n    keyPointIndex: number;\r\n\r\n    /**\r\n     * one of handlers of the curve when keyPoint's type is 'C'\r\n     */\r\n    controller1?: IController;\r\n\r\n    /**\r\n     * another handler of the curve when keyPoint's type is 'C'\r\n     */\r\n    controller2?: IController;\r\n\r\n    /**\r\n     * Straight line composed of aux-point(controller1) and origin-point\r\n     */\r\n    auxLine1?: any;\r\n\r\n    /**\r\n     * Straight line composed of aux-point(controller2) and origin-point\r\n     */\r\n    auxLine2?: any;\r\n\r\n    /**\r\n     * When current keyPoint is a handler of curve, attribute will be set\r\n     * 'handleA' as left handler\r\n     * 'handleB' as right handler\r\n     */\r\n    handleName?: string;\r\n\r\n    constructor({\r\n        type,\r\n        point,\r\n        pointType,\r\n        relationPoints,\r\n        keyPointIndex,\r\n        controller1,\r\n        controller2,\r\n        auxLine1,\r\n        auxLine2,\r\n        handleName\r\n    }: any = {}) {\r\n        this.type = type;\r\n        this.point = point;\r\n        this.pointType = pointType || CONST.POINT_TYPE.STRAIGHT;\r\n        this.relationPoints = relationPoints || [];\r\n        this.keyPointIndex = keyPointIndex;\r\n        this.controller1 = controller1;\r\n        this.controller2 = controller2;\r\n        this.auxLine1 = auxLine1;\r\n        this.auxLine2 = auxLine2;\r\n        this.handleName = handleName;\r\n    }\r\n}\r\n\r\n/**\r\n * declare Pen Tool Class\r\n */\r\nclass Pen {\r\n    /**\r\n     * Whether the penTool's edit mode is opened. Default false.\r\n     */\r\n    penModeOn: boolean = false;\r\n\r\n    /**\r\n     * Store final path keyPoints data.\r\n     */\r\n    keyPointData: KeyPoint[] = [];\r\n\r\n    /**\r\n     * Store the real path keyPoints data, cause it's different from keyPointData when mousemove.\r\n     */\r\n    keyPointDataCache: KeyPoint[] = [];\r\n\r\n    /**\r\n     * Whether the path is closed\r\n     */\r\n    closeState: boolean = false;\r\n\r\n    /**\r\n     * Whether the real-path is closed. \r\n     * Fill the path containing area when cursor position and path start-point coincide during mousemoving (but not mouseup).\r\n     */\r\n    cacheCloseState: boolean = false;\r\n\r\n    /**\r\n     * The svg Path string\r\n     */\r\n    realPathStr: string;\r\n\r\n    /**\r\n     * Fabric.Path object\r\n     */\r\n    pathRealObject: object;\r\n\r\n    /**\r\n     * State of keyPoint.\r\n     * 'new' when mousedown which means new keyPoint, reset null when mouseup \r\n     */\r\n    keyPointState: string;\r\n\r\n    /**\r\n     * Index of current operation point in the keyPointData\r\n     */\r\n    currentKeyPointIndex: number;\r\n\r\n    /**\r\n     * Save the lastest mousedown positon\r\n     */\r\n    penMouseMoveFix: any;\r\n\r\n    /**\r\n     * Save part of the keyPoint information which is activated by mousedown \r\n     */\r\n    penMouseDownOrigin: any;\r\n\r\n    /**\r\n     * Whether the mousedown event is triggered\r\n     */\r\n    penMouseDown: boolean = false;\r\n\r\n    /**\r\n     * <canvas> element\r\n     */\r\n    canvas: HTMLCanvasElement;\r\n\r\n    /**\r\n     * canvas context('2d')\r\n     */\r\n    canvasCtx: CanvasRenderingContext2D;\r\n\r\n    /**\r\n     * Custom setting options\r\n     */\r\n    options: IPenOptions = {\r\n        circle: new PenCircle(),\r\n        line: new PenLine(),\r\n        pathColor: '#000',\r\n        pathFillColor: '#ebebeb',\r\n        isFillPath: false\r\n    }\r\n\r\n    /**\r\n     * Collection of objects drawn on canvas\r\n     */\r\n    objects: any[] = [];\r\n\r\n    /**\r\n     * Whether edit the keyPoint position\r\n     */\r\n    isEdit: boolean = false;\r\n\r\n    /**\r\n     * Save auxPoint or keyPoint when mousedown on the point\r\n     */\r\n    mousedownTarget?: any;\r\n\r\n    constructor(canvasId: string, options?: any) {\r\n        try {\r\n            if (!canvasId) {\r\n                console.error(\"PenTool must based a canvas, please confirm that the canvasId is passed.\")\r\n            } else {\r\n                this.canvas = <HTMLCanvasElement>document.getElementById(canvasId);\r\n                this.canvasCtx = this.canvas.getContext('2d');\r\n                this.options = {...{\r\n                    circle: new PenCircle(),\r\n                    line: new PenLine(),\r\n                    pathColor: '#000',          // default pathColor\r\n                    pathFillColor: '#ebebeb'    // default pathFillColor\r\n                }, ...options};\r\n\r\n                // fire mouse event\r\n                this._mouseDown();\r\n                this._mouseMove();\r\n                this._mouseUp();\r\n                this._keydown();\r\n                this._mouseDblclick();\r\n            }\r\n        } catch (error) {\r\n            console.error(error.message);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Open drawing mode\r\n     */\r\n    enablePen(): void {\r\n        this.penModeOn = true;\r\n        this.setCursor(CONST.CURSOR_TYPE.NORMAL);\r\n    }\r\n\r\n    /**\r\n     * Exit drawing mode\r\n     * The first call sets currentKeyPointIndex to null and set keyPoint editable\r\n     * The second call removes auxPoints and auxLines\r\n     */\r\n    exitPenMode() {\r\n        if (this.currentKeyPointIndex != null) {\r\n            this.currentKeyPointIndex = null;\r\n            this.isEdit = true;     // set editable\r\n            this.setCursor(CONST.CURSOR_TYPE.NORMAL);\r\n            this.refreshEditPath();\r\n        } else {\r\n            this.penModeOn = false;\r\n            if (this.pathRealObject) {\r\n                // remove auxPoint and auxLine\r\n                let auxPointAndLines = this.objects.filter((object: any) => {\r\n                    return object.penType === CONST.OBJECT_TYPE.PEN_AUX;\r\n                })\r\n                this.removeObjects(...auxPointAndLines);\r\n            }\r\n\r\n            this.setCursor(CONST.CURSOR_TYPE.DEFAULT);\r\n            // reset params\r\n            this.currentKeyPointIndex = null;\r\n            this.isEdit = false;\r\n        }\r\n        this.refreshRender();\r\n    }\r\n\r\n    /**\r\n     * Set cursor style\r\n     * @param type cursor type\r\n     */\r\n    setCursor(type: string): void {\r\n        if (type === CONST.CURSOR_TYPE.DEFAULT) {\r\n            this.canvas.style.cursor = 'default';\r\n        } else {\r\n            this.canvas.style.cursor = `url(${CURSOR_CONFIG[type]}), default`;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * fire mousedown event\r\n     */\r\n    _mouseDown(): void {\r\n        this.canvas.addEventListener(\"mousedown\", event => {\r\n            if (this.penModeOn) {\r\n                this._penMouseDown(event);\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * fire mouseMove event\r\n     */\r\n    _mouseMove(): void {\r\n        this.canvas.addEventListener(\"mousemove\", event => {\r\n            if (this.penModeOn) {\r\n                if (this.penMouseDown) {\r\n                    this.setCursor(CONST.CURSOR_TYPE.MOVE);\r\n                }\r\n                this._penMouseMove(event);\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * fire mouseup event\r\n     */\r\n    _mouseUp(): void {\r\n        this.canvas.addEventListener(\"mouseup\", event => {\r\n            if (this.penModeOn) {\r\n                this.setCursor(CONST.CURSOR_TYPE.NORMAL);\r\n                this._penMouseUp(event);\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * fire path double click event\r\n     */\r\n    _mouseDblclick(): void {\r\n        this.canvas.addEventListener(\"dblclick\", event => {\r\n            if (this.penModeOn) {\r\n                let target = this._getMouseOverTarget(event);\r\n                if (target && target.penType === CONST.OBJECT_TYPE.PEN_AUX && target.handleName == null) {\r\n                    this.changeKeyPointType(target);\r\n                    this.refreshRender();\r\n                }\r\n            } else {\r\n                let point: IPoint = {\r\n                        x: event.offsetX,\r\n                        y: event.offsetY\r\n                    }, \r\n                    path: Path2D = new Path2D(this.realPathStr),\r\n                    isInPath: boolean = this.canvasCtx.isPointInPath(path, point.x, point.y);\r\n                if (isInPath) {\r\n                    this.setCursor(CONST.CURSOR_TYPE.NORMAL);\r\n                    this.generateEditablePath();\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * fire keydown event\r\n     * Support to press ESC to exit drawing mode\r\n     */\r\n    _keydown(): void {\r\n        // Set the tabIndex value of canvas so that canvas can get focus. Only in this way can canvas respond to keyboard events\r\n        this.canvas.setAttribute(\"tabIndex\", \"0\");\r\n\r\n        this.canvas.addEventListener(\"keydown\", event => {\r\n            if (this.penModeOn) {\r\n                if (event.keyCode === 27) {\r\n                    this.exitPenMode();\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Implementation of MouseDown \r\n     * @param event \r\n     */\r\n    _penMouseDown(event: MouseEvent): void {\r\n        let target = this._getMouseOverTarget(event),\r\n            x = event.offsetX,\r\n            y = event.offsetY,\r\n            index: number;\r\n        this.penMouseDown = true;\r\n        this.mousedownTarget = target;\r\n        this.keyPointDataCache = null;\r\n        this.penMouseMoveFix = { x, y };\r\n\r\n        // update aux point fill color\r\n        this._matchObjectsByProrerty(\"penType\", CONST.OBJECT_TYPE.PEN_AUX, (object: any) => {\r\n            object.fill = \"#fff\";\r\n        })\r\n\r\n        // checks if the target is aux point\r\n        if (target !== null && target.penType === CONST.OBJECT_TYPE.PEN_AUX) {\r\n            index = target.keyPointIndex;\r\n            // fill the aux point \r\n            target.fill = target.stroke;\r\n\r\n            /**\r\n             * When the first and the last keyPoint coincide, the path is closed.\r\n             * Path is closed, set keyPoints editable.\r\n             */\r\n            if (this.keyPointData.length > 1 && this.currentKeyPointIndex === this.keyPointData.length - 1 && index === 0) {\r\n                this.closeState = true;\r\n            }\r\n\r\n            if (this.closeState || index !== this.keyPointData.length - 1) {\r\n                this.isEdit = true;\r\n            }\r\n            \r\n            this.currentKeyPointIndex = index;\r\n            this.setMousedownOrigin();\r\n            this.refreshEditPath();\r\n            return;\r\n        }\r\n\r\n        /**\r\n         * Normally, add keyPoint\r\n         */\r\n        if (this.keyPointData.length === 0 || this.currentKeyPointIndex === this.keyPointData.length - 1 && !this.closeState) {\r\n            let keyPoint: KeyPoint;\r\n            // first keyPoint, set type 'M'\r\n            if (this.keyPointData.length === 0) {\r\n                keyPoint = new KeyPoint({\r\n                    type: 'M',\r\n                    point: { x, y },\r\n                    pointType: CONST.POINT_TYPE.STRAIGHT,\r\n                    relationPoints: [x, y],\r\n                    keyPointIndex: this.keyPointData.length\r\n                })\r\n            } else {\r\n                let preKeyPoint = this.keyPointData[this.keyPointData.length - 1],\r\n                    preLeft = preKeyPoint.point.x,\r\n                    preTop = preKeyPoint.point.y;\r\n                if (preKeyPoint.pointType !== CONST.POINT_TYPE.STRAIGHT) {\r\n                    preLeft = preKeyPoint.controller2.x;\r\n                    preTop = preKeyPoint.controller2.y;\r\n                }\r\n                keyPoint = new KeyPoint({\r\n                    type: 'C',\r\n                    point: { x, y },\r\n                    pointType: CONST.POINT_TYPE.STRAIGHT,\r\n                    relationPoints: [preLeft, preTop, x, y, x, y],\r\n                    keyPointIndex: this.keyPointData.length\r\n                })\r\n            }\r\n\r\n            let circle = new PenCircle({\r\n                x: x,\r\n                y: y,\r\n                keyPointIndex: keyPoint.keyPointIndex,\r\n                fill: this.options.circle.fill,\r\n                stroke: this.options.circle.stroke\r\n            })\r\n            this.addCanvasObjects(circle);\r\n\r\n            this.keyPointData.push(keyPoint);\r\n            this.currentKeyPointIndex = this.keyPointData.length - 1;\r\n\r\n            this.refreshEditPath();\r\n            // add new keyPoint, set state\r\n            this.keyPointState = CONST.PATH_STATE.NEW;\r\n        } \r\n        \r\n        // clickoutside or 'ESC' keypress to exit penmode when editmode\r\n        else if (this.currentKeyPointIndex == null) {\r\n            this.exitPenMode();\r\n        } \r\n        \r\n        // first time: clickoutside or 'ESC' keypress set edit mode and reset currentKeyPointIndex\r\n        else if (this.keyPointData.length > 0 && (this.closeState || this.currentKeyPointIndex !== this.keyPointData.length - 1)) {\r\n            this.currentKeyPointIndex = null;\r\n            this.isEdit = true;\r\n        }\r\n        this.refreshRender();\r\n    }\r\n\r\n    /**\r\n     * Implementation of MouseMove\r\n     * @param event \r\n     */\r\n    _penMouseMove(event: MouseEvent): void {\r\n        let x = event.offsetX,\r\n            y = event.offsetY,\r\n            target = this._getMouseOverTarget(event);\r\n\r\n\r\n        if (!this.isEdit) {\r\n            // keep mousedown and mousemoving will draw a curve on canvas when current keyPoint is new\r\n            if (this.keyPointState === CONST.PATH_STATE.NEW) {\r\n                if (Math.abs(this.penMouseMoveFix.x - x) > 2 || Math.abs(this.penMouseMoveFix.y - y) > 2) {\r\n                    this.changeKeyPointPos(x, y, CONST.CONTROL_TYPE.RIGHT);\r\n                }\r\n            } else {\r\n                /**\r\n                 * when target is keyPoint\r\n                 * 1. target is not start or \r\n                 * 2. the path is closed or\r\n                 * 3. target is start but currentkeyPointIndex is not the last keyPoint's index(otherwise the path is closed).\r\n                 */\r\n                if (target != null && target.penType === CONST.OBJECT_TYPE.PEN_AUX && (target.keyPointIndex !== 0 || this.closeState || (target.keyPointIndex === 0 && this.currentKeyPointIndex !== this.keyPointData.length - 1))) {\r\n                    if (!this.penMouseDown) {\r\n                        this.setCursor(CONST.CURSOR_TYPE.MOVE);\r\n                    }\r\n                } else {\r\n                    this.setCursor(CONST.CURSOR_TYPE.NORMAL);\r\n                    if (this.currentKeyPointIndex === this.keyPointData.length - 1 && !this.closeState) {\r\n                        let keyPoint: KeyPoint,\r\n                            prev = this.keyPointData[this.currentKeyPointIndex],\r\n                            prevLeft: number,\r\n                            prevTop: number;\r\n                        if (this.keyPointDataCache == null) {\r\n                            this.keyPointDataCache = JSON.parse(JSON.stringify(this.keyPointData));\r\n                            this.keyPointDataCache.push(new KeyPoint());\r\n                        } else {\r\n                            this.cacheCloseState = false;\r\n                        }\r\n\r\n                        if (this.keyPointData[this.currentKeyPointIndex].type === \"M\") {\r\n                            prevLeft = prev.relationPoints[0];\r\n                            prevTop = prev.relationPoints[1];\r\n                        } else {\r\n                            prevLeft = prev.relationPoints[4];\r\n                            prevTop = prev.relationPoints[5];\r\n                        }\r\n\r\n                        if (prev.pointType !== CONST.POINT_TYPE.STRAIGHT) {\r\n                            prevLeft = prev.controller2.x;\r\n                            prevTop = prev.controller2.y;\r\n                        }\r\n                        keyPoint = new KeyPoint({\r\n                            type: \"C\",\r\n                            point: { x, y },\r\n                            pointType: CONST.POINT_TYPE.STRAIGHT,\r\n                            relationPoints: [prevLeft, prevTop, x, y, x, y],\r\n                            keyPointIndex: this.keyPointDataCache.length - 1\r\n                        })\r\n                        this.keyPointDataCache[this.keyPointDataCache.length - 1] = keyPoint;\r\n\r\n                        // path closed\r\n                        if (this.keyPointData.length > 1 && target !== null && target.penType === CONST.OBJECT_TYPE.PEN_AUX && target.keyPointIndex === 0) {\r\n                            this.cacheCloseState = true;\r\n                            this.setCursor(CONST.CURSOR_TYPE.CLOSE);\r\n                        } else {\r\n                            this.setCursor(CONST.CURSOR_TYPE.ADD);\r\n                        }\r\n\r\n                        this.refreshEditPath(true);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        /**\r\n         * keyPoint moving\r\n         * alt + handler keypoint moving: change path curve\r\n         */\r\n        else if (this.mousedownTarget != null && this.mousedownTarget.penType === CONST.OBJECT_TYPE.PEN_AUX && this.penMouseDown) {\r\n            let target = this.mousedownTarget;\r\n            target.x = x;\r\n            target.y = y;\r\n            if (target.handleName === CONST.CONTROL_TYPE.LEFT) {\r\n                if (event.altKey) {\r\n                    this.changeKeyPointType(target, CONST.POINT_TYPE.DISJOINTED);\r\n                } else {\r\n                    this.changeKeyPointType(target);\r\n                }\r\n                this.changeKeyPointPos(x, y, CONST.CONTROL_TYPE.LEFT);\r\n            } else if (target.handleName === CONST.CONTROL_TYPE.RIGHT) {\r\n                if (event.altKey) {\r\n                    this.changeKeyPointType(target, CONST.POINT_TYPE.DISJOINTED);\r\n                } else {\r\n                    this.changeKeyPointType(target);\r\n                }\r\n                this.changeKeyPointPos(x, y, CONST.CONTROL_TYPE.RIGHT);\r\n            } else {\r\n                this.changeKeyPointPos(x, y, CONST.CONTROL_TYPE.MAIN);\r\n            }\r\n        }\r\n        this.refreshRender();\r\n    }\r\n\r\n    /**\r\n     * Implementation of MouseUp\r\n     * @param event \r\n     */\r\n    _penMouseUp(event: MouseEvent): void {\r\n        this.penMouseDown = false;\r\n        if (this.currentKeyPointIndex === this.keyPointData.length - 1 && !this.closeState && this.penMouseMoveFix && event.offsetX === this.penMouseMoveFix.x && event.offsetY === this.penMouseMoveFix.y) {\r\n            this.isEdit = false;\r\n        }\r\n\r\n        // set main keyPoint fill\r\n        this._matchObjectsByProrerty(\"penType\", CONST.OBJECT_TYPE.PEN_AUX, (object: any) => {\r\n            if (object.keyPointIndex === this.currentKeyPointIndex && object.handleName == null) {\r\n                object.fill = object.stroke;\r\n            }\r\n        })\r\n\r\n        /** reset params */\r\n        this.keyPointState = null;\r\n        this.penMouseMoveFix = null;\r\n        this.penMouseDownOrigin = null;\r\n        this.refreshRender();\r\n    }\r\n\r\n    /**\r\n     * update keyPoint or handle point position\r\n     * @param x mouseOffsetX relative to canvas\r\n     * @param y mouseOffsetY relative to canvas\r\n     * @param type control point type\r\n     */\r\n    changeKeyPointPos(x: number, y: number, type: string = CONST.CONTROL_TYPE.MAIN): void {\r\n        let index = this.currentKeyPointIndex,\r\n            curKeyPoint: KeyPoint = this.keyPointData[index],\r\n            originPoint = curKeyPoint.point;\r\n\r\n        if ((type === CONST.CONTROL_TYPE.LEFT || type === CONST.CONTROL_TYPE.RIGHT) && curKeyPoint.pointType == CONST.POINT_TYPE.STRAIGHT) {\r\n            this.createPathCurveAux(curKeyPoint);\r\n        }\r\n\r\n        // keyPoint\r\n        if (type === CONST.CONTROL_TYPE.MAIN) {\r\n            let x1: number,\r\n                x2: number,\r\n                y1: number,\r\n                y2: number,\r\n                minulsX: number,\r\n                minulsY: number;\r\n\r\n            if (this.penMouseDownOrigin) {\r\n                if (this.penMouseDownOrigin.x) {\r\n                    minulsX = this.penMouseDownOrigin.x - x;\r\n                    minulsY = this.penMouseDownOrigin.y - y;\r\n                }\r\n\r\n                if (this.penMouseDownOrigin.x1) {\r\n                    x1 = this.penMouseDownOrigin.x1 - minulsX;\r\n                    y1 = this.penMouseDownOrigin.y1 - minulsY;\r\n                }\r\n\r\n                if (this.penMouseDownOrigin.x2) {\r\n                    x2 = this.penMouseDownOrigin.x2 - minulsX;\r\n                    y2 = this.penMouseDownOrigin.y2 - minulsY;\r\n                }\r\n\r\n                this.updatePenPathControll(curKeyPoint, { x, y, x1, y1, x2, y2 });\r\n            }\r\n\r\n            originPoint.x = x;\r\n            originPoint.y = y;\r\n\r\n            if (curKeyPoint.type === \"M\") {\r\n                curKeyPoint.relationPoints[0] = x;\r\n                curKeyPoint.relationPoints[1] = y;\r\n                if (index + 1 <= this.keyPointData.length - 1) {\r\n                    let nextItem = this.keyPointData[index + 1];\r\n                    if (curKeyPoint.pointType != CONST.POINT_TYPE.STRAIGHT) {\r\n                        nextItem.relationPoints[0] = x2;\r\n                        nextItem.relationPoints[1] = y2;\r\n                    } else {\r\n                        nextItem.relationPoints[0] = x;\r\n                        nextItem.relationPoints[1] = y;\r\n                    }\r\n                }\r\n\r\n                if (curKeyPoint.pointType != CONST.POINT_TYPE.STRAIGHT) {\r\n                    curKeyPoint.relationPoints[2] = x1;\r\n                    curKeyPoint.relationPoints[3] = y1;\r\n                }\r\n                curKeyPoint.point = { x, y };\r\n            } else {\r\n                if (curKeyPoint.pointType != CONST.POINT_TYPE.STRAIGHT) {\r\n                    curKeyPoint.relationPoints[2] = x1;\r\n                    curKeyPoint.relationPoints[3] = y1;\r\n                } else {\r\n                    curKeyPoint.relationPoints[2] = x;\r\n                    curKeyPoint.relationPoints[3] = y;\r\n                }\r\n\r\n                curKeyPoint.relationPoints[4] = x;\r\n                curKeyPoint.relationPoints[5] = y;\r\n\r\n                if (index + 1 <= this.keyPointData.length - 1) {\r\n                    let nextItem = this.keyPointData[index + 1];\r\n                    if (curKeyPoint.pointType != CONST.POINT_TYPE.STRAIGHT) {\r\n                        nextItem.relationPoints[0] = x2;\r\n                        nextItem.relationPoints[1] = y2;\r\n                    } else {\r\n                        nextItem.relationPoints[0] = x;\r\n                        nextItem.relationPoints[1] = y;\r\n                    }\r\n                }\r\n                curKeyPoint.point = { x, y };\r\n            }\r\n        } \r\n        // handle aux keyPoint\r\n        else if (type === CONST.CONTROL_TYPE.LEFT || type === CONST.CONTROL_TYPE.RIGHT) {\r\n            if (curKeyPoint.pointType == CONST.POINT_TYPE.STRAIGHT) {\r\n                curKeyPoint.pointType = CONST.POINT_TYPE.MIRRORED;\r\n            }\r\n            let x1: number,\r\n                y1: number,\r\n                x2: number,\r\n                y2: number;\r\n            let originX = curKeyPoint.relationPoints[4],\r\n                originY = curKeyPoint.relationPoints[5];\r\n\r\n            if (curKeyPoint.type == \"M\") {\r\n                originX = curKeyPoint.relationPoints[0];\r\n                originY = curKeyPoint.relationPoints[1];\r\n            }\r\n\r\n            if (curKeyPoint.pointType == CONST.POINT_TYPE.MIRRORED) {\r\n                if (type === CONST.CONTROL_TYPE.RIGHT) {\r\n                    x1 = originX * 2 - x;\r\n                    y1 = originY * 2 - y;\r\n                    x2 = x;\r\n                    y2 = y;\r\n                } else {\r\n                    x2 = originX * 2 - x;\r\n                    y2 = originY * 2 - y;\r\n                    x1 = x;\r\n                    y1 = y;\r\n                }\r\n\r\n                this.updatePenPathControll(curKeyPoint, { x: originX, y: originY, x1, y1, x2, y2 });\r\n\r\n                if (curKeyPoint.type === \"M\") {\r\n                    if (index + 1 <= this.keyPointData.length - 1) {\r\n                        let nextItem = this.keyPointData[index + 1];\r\n                        nextItem.relationPoints[0] = x2;\r\n                        nextItem.relationPoints[1] = y2;\r\n                    }\r\n\r\n                    if (curKeyPoint.pointType != CONST.POINT_TYPE.STRAIGHT) {\r\n                        curKeyPoint.relationPoints[2] = x1;\r\n                        curKeyPoint.relationPoints[3] = y1;\r\n                    }\r\n                } else {\r\n                    curKeyPoint.relationPoints[2] = x1;\r\n                    curKeyPoint.relationPoints[3] = y1;\r\n\r\n                    if (index + 1 <= this.keyPointData.length - 1) {\r\n                        var nextItem = this.keyPointData[index + 1];\r\n                        nextItem.relationPoints[0] = x2;\r\n                        nextItem.relationPoints[1] = y2;\r\n                    }\r\n                }\r\n            } else if (curKeyPoint.pointType == CONST.POINT_TYPE.DISJOINTED) {\r\n                if (type === CONST.CONTROL_TYPE.RIGHT) {\r\n                    x2 = x;\r\n                    y2 = y;\r\n                    this.updatePenPathControll(curKeyPoint, { x: originX, y: originY, x2, y2 }, CONST.CONTROL_TYPE.RIGHT);\r\n\r\n                    if (curKeyPoint.type === \"M\") {\r\n                        if (index + 1 <= this.keyPointData.length - 1) {\r\n                            let nextItem = this.keyPointData[index + 1];\r\n                            nextItem.relationPoints[0] = x2;\r\n                            nextItem.relationPoints[1] = y2;\r\n                        }\r\n                    } else {\r\n                        if (index + 1 <= this.keyPointData.length - 1) {\r\n                            let nextItem = this.keyPointData[index + 1];\r\n                            nextItem.relationPoints[0] = x2;\r\n                            nextItem.relationPoints[1] = y2;\r\n                        }\r\n\r\n                    }\r\n                } else {\r\n                    x1 = x;\r\n                    y1 = y;\r\n                    this.updatePenPathControll(curKeyPoint, { x: originX, y: originY, x1, y1 }, CONST.CONTROL_TYPE.LEFT);\r\n\r\n                    if (curKeyPoint.type === \"M\") {\r\n                        if (curKeyPoint.pointType != \"straight\") {\r\n                            curKeyPoint.relationPoints[2] = x1;\r\n                            curKeyPoint.relationPoints[3] = y1;\r\n                        }\r\n                    } else {\r\n                        curKeyPoint.relationPoints[2] = x1;\r\n                        curKeyPoint.relationPoints[3] = y1;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.refreshEditPath();\r\n    }\r\n\r\n    /**\r\n     * creating aux control handlers for curve\r\n     * @param curKeyPoint the current operating keyPoint\r\n     */\r\n    createPathCurveAux(curKeyPoint: KeyPoint): void {\r\n        let originPoint = curKeyPoint.point,\r\n            x = originPoint.x,\r\n            y = originPoint.y;\r\n\r\n        let circle1 = new PenCircle({\r\n            x,\r\n            y,\r\n            handleName: CONST.CONTROL_TYPE.LEFT,\r\n            keyPointIndex: curKeyPoint.keyPointIndex,\r\n            fill: this.options.circle.fill,\r\n            stroke: this.options.circle.stroke,\r\n            lineWidth: this.options.circle.lineWidth\r\n        }),\r\n        circle2 = new PenCircle({\r\n            x,\r\n            y,\r\n            handleName: CONST.CONTROL_TYPE.RIGHT,\r\n            keyPointIndex: curKeyPoint.keyPointIndex,\r\n            fill: this.options.circle.fill,\r\n            stroke: this.options.circle.stroke,\r\n            lineWidth: this.options.circle.lineWidth\r\n        }),\r\n        line1 = new PenLine({\r\n            x1: x, y1: y, x2: x, y2: y,\r\n            stroke: this.options.line.stroke,\r\n            lineWidth: this.options.line.lineWidth\r\n        }),\r\n        line2 = new PenLine({\r\n            x1: x, y1: y, x2: x, y2: y,\r\n            stroke: this.options.line.stroke,\r\n            lineWidth: this.options.line.lineWidth\r\n        });\r\n        curKeyPoint.controller1 = circle1;\r\n        curKeyPoint.controller2 = circle2;\r\n        curKeyPoint.auxLine1 = line1;\r\n        curKeyPoint.auxLine2 = line2;\r\n\r\n        this.addCanvasObjects(circle1, circle2, line1, line2);\r\n    }\r\n\r\n    /**\r\n     * update the handlers of the curve\r\n     * @param item operating keyPoint\r\n     * @param position the key coordinates. {x, y, x1, y1, x2, y2}\r\n     * (x, y) is the main keyPoint's coordinates. (x1, y1) and (x2, y2) is the two controllers' coordinates.\r\n     * @param type Indicates which auxLine and controller to update\r\n     */\r\n    updatePenPathControll(item: KeyPoint, position: any, type?: string) {\r\n        let x = position.x,\r\n            y = position.y,\r\n            x1 = position.x1,\r\n            y1 = position.y1,\r\n            x2 = position.x2,\r\n            y2 = position.y2,\r\n            { controller1, controller2, auxLine1, auxLine2 } = { ...item };\r\n\r\n        if (type == null || type === CONST.CONTROL_TYPE.LEFT) {\r\n            if (controller1 != null) {\r\n                controller1.x = x1;\r\n                controller1.y = y1;\r\n            }\r\n            if (auxLine1 != null) {\r\n                auxLine1.x1 = x1;\r\n                auxLine1.y1 = y1;\r\n                auxLine1.x2 = x;\r\n                auxLine1.y2 = y;\r\n            }\r\n        }\r\n\r\n        if (type == null || type === CONST.CONTROL_TYPE.RIGHT) {\r\n            if (controller2 != null) {\r\n                controller2.x = x2;\r\n                controller2.y = y2;\r\n            }\r\n            if (auxLine2 != null) {\r\n                auxLine2.x1 = x2;\r\n                auxLine2.y1 = y2;\r\n                auxLine2.x2 = x;\r\n                auxLine2.y2 = y;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * save the coordinate informations when mousedown\r\n     * (x, y) is the main keyPoint's coordinate\r\n     * (x1, y1) and (x2, y2) is the controllers' coordinate\r\n     */\r\n    setMousedownOrigin() {\r\n        let curKeyPoint = this.keyPointData[this.currentKeyPointIndex],\r\n            controller1 = curKeyPoint.controller1,\r\n            controller2 = curKeyPoint.controller2,\r\n            originPoint = curKeyPoint.point,\r\n            origin: any = {};\r\n\r\n        if (controller1 != null) {\r\n            origin.x1 = controller1.x;\r\n            origin.y1 = controller1.y;\r\n        }\r\n\r\n        if (controller1 != null) {\r\n            origin.x2 = controller2.x;\r\n            origin.y2 = controller2.y;\r\n        }\r\n\r\n        if (originPoint != null) {\r\n            origin.x = originPoint.x;\r\n            origin.y = originPoint.y;\r\n        }\r\n        this.penMouseDownOrigin = origin;\r\n    };\r\n\r\n    /**\r\n     * update the pathObject when path is modified\r\n     * @param isCashed whether update path with the keyPointDataCache \r\n     */\r\n    refreshEditPath(isCashed: boolean = false): void {\r\n        let keyPointData = this.keyPointData,\r\n            closeState = this.closeState;\r\n        if (keyPointData.length === 0) return;\r\n\r\n        if (isCashed) {\r\n            keyPointData = this.keyPointDataCache;\r\n            closeState = this.cacheCloseState;\r\n        }\r\n        let pathStr: string = this._generatePathStr(keyPointData),\r\n            fillColor: string = null,\r\n            realPathStr = pathStr,\r\n            auxPathStr = pathStr;\r\n\r\n        if (closeState) {\r\n            fillColor = this.options.pathFillColor;\r\n            realPathStr += ' Z';\r\n            isCashed ? auxPathStr += ' Z' : '';\r\n        }\r\n        if (this.realPathStr != null && this.realPathStr === pathStr && isCashed) {\r\n            return;\r\n        } else {\r\n            this.realPathStr = realPathStr;\r\n\r\n            // remove and redraw path\r\n            let pathObjects = this.objects.filter(object => {\r\n                return object.type === CONST.OBJECT_TYPE.PATH;\r\n            })\r\n            this.removeObjects(...pathObjects);\r\n            this.pathRealObject = {\r\n                pathStr: this.realPathStr,\r\n                type: CONST.OBJECT_TYPE.PATH,\r\n                fill: fillColor || '#ebebeb',\r\n                closeState: closeState,\r\n                index: -Infinity    // path's z-index keep lowest\r\n            }\r\n            this.addCanvasObjects(this.pathRealObject);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * generate the pathStr according to keyPointData\r\n     * @param keyPointData \r\n     */\r\n    _generatePathStr(keyPointData: KeyPoint[]): string {\r\n        let pathStr = \"\";\r\n        keyPointData.forEach(keyPoint => {\r\n            let pathSection = \"\";\r\n            if (keyPoint.type === \"M\") {\r\n                let str = `M ${keyPoint.relationPoints[0]} ${keyPoint.relationPoints[1]} `;\r\n                pathSection += str;\r\n            } else if (keyPoint.type === \"C\") {\r\n                pathSection += \"C \";\r\n                keyPoint.relationPoints.forEach(value => {\r\n                    pathSection += value + \" \";\r\n                })\r\n            }\r\n            pathStr += pathSection;\r\n        })\r\n\r\n        if (this.closeState) {\r\n            let firstKeyPoint = keyPointData[0],\r\n                lastkeyPoint = keyPointData[keyPointData.length - 1];\r\n            pathStr += \"C \";\r\n            if (lastkeyPoint.pointType !== CONST.POINT_TYPE.STRAIGHT) {\r\n                pathStr += `${lastkeyPoint.controller2.x} ${lastkeyPoint.controller2.y} `;\r\n            } else {\r\n                pathStr += `${lastkeyPoint.relationPoints[4]} ${lastkeyPoint.relationPoints[5]} `;\r\n            }\r\n\r\n            if (firstKeyPoint.pointType !== CONST.POINT_TYPE.STRAIGHT) {\r\n                pathStr += `${firstKeyPoint.relationPoints[2]} ${firstKeyPoint.relationPoints[3]} `;\r\n            } else {\r\n                pathStr += `${firstKeyPoint.relationPoints[0]} ${firstKeyPoint.relationPoints[1]} `;\r\n            }\r\n\r\n            pathStr += `${firstKeyPoint.relationPoints[0]} ${firstKeyPoint.relationPoints[1]} `;\r\n        }\r\n        return pathStr;\r\n    }\r\n\r\n    /**\r\n     * refresh and redraw the canvas\r\n     */\r\n    refreshRender(): void {\r\n        this.canvasCtx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        this._matchObjectsByProrerty(\"penType\", CONST.OBJECT_TYPE.PEN_AUX, (object: any) => {\r\n            if (object.type === CONST.OBJECT_TYPE.CIRCLE) {\r\n                this._bringToFront(object);\r\n            }\r\n        })\r\n        this.drawObjects(this.objects || []);\r\n    }\r\n\r\n    /**\r\n     * drawing object on canvas\r\n     * @param objects objects to be drawing\r\n     */\r\n    drawObjects(objects: Array<any>): void {\r\n        objects.forEach(object => {\r\n            switch (object.type) {\r\n                case CONST.OBJECT_TYPE.CIRCLE:\r\n                    this.drawCircle(object);\r\n                    break;\r\n                case CONST.OBJECT_TYPE.LINE:\r\n                    this.drawLine(object);\r\n                    break;\r\n                case CONST.OBJECT_TYPE.PATH:\r\n                    this.drawPath(object);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * draw circle on canvas\r\n     * @param options config of circle\r\n     */\r\n    drawCircle(options: any) {\r\n        this.canvasCtx.fillStyle = options.fill;\r\n        this.canvasCtx.strokeStyle = options.stroke;\r\n        this.canvasCtx.beginPath();\r\n        this.canvasCtx.arc(\r\n            options.x,\r\n            options.y,\r\n            options.radius,\r\n            0,\r\n            2 * Math.PI\r\n        )\r\n        this.canvasCtx.fill();\r\n        this.canvasCtx.stroke();\r\n    }\r\n\r\n    /**\r\n     * draw path on canvas\r\n     * @param options config of circle\r\n     */\r\n    drawPath(options: any) {\r\n        this.canvasCtx.fillStyle = this.options.pathFillColor;\r\n        this.canvasCtx.strokeStyle = this.options.pathColor;\r\n\r\n        this.canvasCtx.beginPath();\r\n        let path = new Path2D(this.realPathStr);\r\n        this.canvasCtx.stroke(path);\r\n        if (options.closeState) {\r\n            /**\r\n             * keyPointDataCache is null indicate that the drawing is completed.\r\n             */\r\n            if (!this.keyPointDataCache && this.options.isFillPath) {\r\n                this.canvasCtx.fill(path);\r\n            } \r\n            \r\n            /**\r\n             * when drawing uncomplete, the cache path closed, then fill\r\n             */\r\n            else if (this.keyPointDataCache && this.keyPointData.length !== this.keyPointDataCache.length) {\r\n                this.canvasCtx.fill(path);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * draw straight line on canvas\r\n     * @param options config of circle\r\n     */\r\n    drawLine(options: any) {\r\n        this.canvasCtx.fillStyle = options.fill;\r\n        this.canvasCtx.strokeStyle = options.stroke;\r\n        // this.canvasCtx.lineWidth = 5;\r\n        this.canvasCtx.beginPath();\r\n        this.canvasCtx.moveTo(options.x1, options.y1);\r\n        this.canvasCtx.lineTo(options.x2, options.y2);\r\n        this.canvasCtx.stroke();\r\n    }\r\n\r\n    /**\r\n     * Add objects to Pen instance for rendering\r\n     * @param objects objects for rendering\r\n     * @returns returns adding objects\r\n     */\r\n    addCanvasObjects(...objects: Array<any>): Array<any> {\r\n        objects.forEach(object => {\r\n            if (object.index == null) {\r\n                object.index = this.objects.length;\r\n            }\r\n            this.objects.push(object);\r\n        })\r\n        return objects;\r\n    }\r\n\r\n    /**\r\n     * remove objects from Pen instance\r\n     * @param objects objects to remove\r\n     */\r\n    removeObjects(...objects: Array<any>): void {\r\n        objects.forEach(object => {\r\n            this.removeSingleObject(object)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * match currect object and remove it from instance\r\n     * @param object object to remove\r\n     */\r\n    removeSingleObject(object: any): void {\r\n        for (let i = this.objects.length - 1; i >= 0; i--) {\r\n            const item = this.objects[i];\r\n            if (item === object) {\r\n                this.objects.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the mouseover target\r\n     * @param event \r\n     */\r\n    _getMouseOverTarget(event: MouseEvent): any {\r\n        let point: IPoint = {\r\n            x: event.offsetX,\r\n            y: event.offsetY\r\n        }, target: any = null;\r\n\r\n        // sort objects by index\r\n        this.objects.sort((a, b) => {\r\n            return a - b;\r\n        })\r\n\r\n        for (let i = this.objects.length - 1; i >= 0; i--) {\r\n            const object = this.objects[i];\r\n            if (this._containsPoint(point, object)) {\r\n                target = object;\r\n                break;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n\r\n    /**\r\n     * Checks if point is inside the object\r\n     * @param point target point, always mouse position\r\n     * @param object target object \r\n     */\r\n    _containsPoint(point: IPoint, object: any): boolean {\r\n        if (!object.type) return false;\r\n        if (object.type === CONST.OBJECT_TYPE.CIRCLE) {\r\n            let radius: number = object.radius,\r\n                x: number = object.x,\r\n                y: number = object.y;\r\n            return point.x <= x + radius && point.x >= x - radius\r\n                && point.y <= y + radius && point.y >= y - radius;\r\n\r\n        } else if (object.type === CONST.OBJECT_TYPE.LINE) {\r\n            // calculate the slope of line\r\n            let slope: number = (object.y1 - object.y2) / (object.x1 - object.x2),\r\n                slope2: number = (point.y - object.y1) / (point.x - object.x1);\r\n\r\n            // slope is equal and the point coordinate is included in the line area indicate collinearity\r\n            return slope === slope2 &&\r\n                (point.x >= object.x1 && point.x <= object.x2 && point.y >= object.y1 && point.y <= object.y2 ||\r\n                    point.x >= object.x2 && point.x <= object.x1 && point.y >= object.y2 && point.y <= object.y1\r\n                )\r\n        } else if (object.type === CONST.OBJECT_TYPE.PATH) {\r\n            let path = new Path2D(object.pathStr);\r\n            return this.canvasCtx.isPointInStroke(path, point.x, point.y);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Matches the object with the specified property name and value, and then performs the callback\r\n     * @param key property name\r\n     * @param value property value\r\n     * @param callback callback function\r\n     */\r\n    _matchObjectsByProrerty(key: string, value: string, callback: Function): void {\r\n        let objects: Array<any> = this.objects;\r\n        objects.forEach(object => {\r\n            // match object\r\n            if (object[key] === value) {\r\n                callback(object);\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Put the object at the end of the array to make canvas draw last\r\n     * so as to achieve the purpose of the object at the top after drawing\r\n     * @param object \r\n     */\r\n    _bringToFront(object: any) {\r\n        object.index = Infinity;    // Make sure the index is the largest\r\n\r\n        // resort objects and set index\r\n        this.objects.sort((a, b) => {\r\n            return a.index - b.index;\r\n        })\r\n        this.objects.forEach((item, index) => {\r\n            item.index = index;\r\n        })\r\n    }\r\n\r\n    /**\r\n     * change the keyPoint type when dblclick on the keyPoint\r\n     * when keyPoint is the straight line keyPoint, it will be a curve keyPoint after dblclick\r\n     * when keyPoint is the curve keyPoint, it will be a straight line keyPoint after dblclick\r\n     * @param target \r\n     * @param pointType the pointType attribute of current operating keyPoint\r\n     */\r\n    changeKeyPointType(target: KeyPoint, pointType?: string): void {\r\n        let index = target.keyPointIndex,\r\n            curPoint = this.keyPointData[index],\r\n            typelist = { ...CONST.POINT_TYPE };\r\n        if (!(pointType == null || (curPoint.pointType === CONST.POINT_TYPE.STRAIGHT && pointType in typelist) || (pointType === CONST.POINT_TYPE.STRAIGHT && curPoint.pointType in typelist))) {\r\n            curPoint.pointType = pointType;\r\n            return;\r\n        }\r\n\r\n        if (curPoint.controller1 == null) {\r\n            this.createPathCurveAux(curPoint);\r\n            curPoint.pointType = pointType || CONST.POINT_TYPE.MIRRORED;\r\n\r\n            let preItem: KeyPoint,      // previous keyPoint to target\r\n                nextItem: KeyPoint,     // next keyPoint to target\r\n                preX: number,           // previous keyPoint's coordinate\r\n                preY: number,           // previous keyPoint's coordinate\r\n                nextX: number,          // next keyPoint's coordinate\r\n                nextY: number,          // next keyPoint's coordinate\r\n                x: number,              // current keyPoint's coordinate\r\n                y: number,              // current keyPoint's coordinate\r\n                radian: number,         // the radian corresponding to the inclination angle of the line between two points\r\n                hypotenuse: number,     // the hypotenuse of a right triangle made up of two points\r\n                x1: number,\r\n                x2: number,\r\n                y1: number,\r\n                y2: number;\r\n            if (target.keyPointIndex === 0) {\r\n                preItem = this.keyPointData[this.keyPointData.length - 1];\r\n            } else {\r\n                preItem = this.keyPointData[target.keyPointIndex - 1];\r\n            }\r\n            if (target.keyPointIndex === this.keyPointData.length - 1) {\r\n                nextItem = this.keyPointData[0];\r\n            } else {\r\n                nextItem = this.keyPointData[target.keyPointIndex + 1];\r\n            }\r\n\r\n            preX = preItem.point.x,\r\n                preY = preItem.point.y,\r\n                nextX = nextItem.point.x,\r\n                nextY = nextItem.point.y,\r\n                x = curPoint.point.x,\r\n                y = curPoint.point.y;\r\n\r\n            radian = Math.atan2(nextY - preY, nextX - preX),\r\n                // The half of the hypotenuse of the right triangle formed by the coordinates of the previous and next keyPoint is used as the base of the offset when calculating the coordinates of the control point\r\n                hypotenuse = Math.sqrt(Math.pow(nextX - preX, 2) + Math.pow(nextY - preY, 2)) / 2;\r\n            x1 = Math.round(x - hypotenuse * Math.cos(radian)),\r\n                y1 = Math.round(y - hypotenuse * Math.sin(radian)),\r\n                x2 = Math.round(x + hypotenuse * Math.cos(radian)),\r\n                y2 = Math.round(y + hypotenuse * Math.sin(radian));\r\n            this.updatePenPathControll(curPoint, { x, y, x1, y1, x2, y2 });\r\n\r\n            if (index + 1 <= this.keyPointData.length - 1) {\r\n                let nextItem = this.keyPointData[index + 1];\r\n                nextItem.relationPoints[0] = x2;\r\n                nextItem.relationPoints[1] = y2;\r\n            }\r\n            curPoint.relationPoints[2] = x1;\r\n            curPoint.relationPoints[3] = y1;\r\n        } else {\r\n            this.removeObjects(curPoint.controller1, curPoint.controller2, curPoint.auxLine1, curPoint.auxLine2);\r\n            delete curPoint.controller1,\r\n                delete curPoint.controller2,\r\n                delete curPoint.auxLine1,\r\n                delete curPoint.auxLine2;\r\n\r\n            curPoint.pointType = CONST.POINT_TYPE.STRAIGHT;\r\n            let x = curPoint.point.x,\r\n                y = curPoint.point.y;\r\n            if (curPoint.pointType === \"M\") {\r\n                if (curPoint.relationPoints.length > 2) {\r\n                    curPoint.relationPoints.splice(-2, 2);\r\n                }\r\n            } else {\r\n                curPoint.relationPoints[2] = x;\r\n                curPoint.relationPoints[3] = y;\r\n            }\r\n            if (index + 1 <= this.keyPointData.length - 1) {\r\n                let nextItem = this.keyPointData[index + 1];\r\n                nextItem.relationPoints[0] = x;\r\n                nextItem.relationPoints[1] = y;\r\n            }\r\n        }\r\n        this.refreshEditPath();\r\n    }\r\n\r\n    /**\r\n     * generate the path with keyPoints and handlers\r\n     */\r\n    generateEditablePath() {\r\n        this.penModeOn = true;\r\n        // reset objects\r\n        this.objects = [];\r\n\r\n        // generate keyPoints and aux\r\n        this.generateAuxPointLine(this.keyPointData);\r\n\r\n        // generate pathstr\r\n        this.refreshEditPath();\r\n        this.refreshRender();\r\n    }\r\n\r\n    /**\r\n     * generate the aux keyPoints and handlers to render\r\n     * @param keyPointData collection of path's keyPoints\r\n     */\r\n    generateAuxPointLine(keyPointData: KeyPoint[] = []) {\r\n        if (keyPointData.length === 0) return;\r\n        keyPointData.forEach((keyPoint, index) => {\r\n            let x = keyPoint.point.x,\r\n                y = keyPoint.point.y,\r\n                circle = new PenCircle({\r\n                    x,\r\n                    y,\r\n                    keyPointIndex: keyPoint.keyPointIndex,\r\n                    fill: this.options.circle.fill,\r\n                    stroke: this.options.circle.stroke\r\n                });\r\n            this.addCanvasObjects(circle);  // add keyPoint\r\n\r\n            // when curve, add handlers \r\n            if (keyPoint.pointType !== CONST.POINT_TYPE.STRAIGHT) {\r\n                this.addCanvasObjects(keyPoint.auxLine1, keyPoint.auxLine2, keyPoint.controller1, keyPoint.controller2);\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nexport default Pen;\r\n\r\n"],"names":["CONST","OBJECT_TYPE","PEN_AUX","CIRCLE","LINE","PATH","POINT_TYPE","STRAIGHT","MIRRORED","DISJOINTED","CONTROL_TYPE","LEFT","RIGHT","MAIN","PATH_STATE","NEW","CURSOR_TYPE","ADD","NORMAL","MOVE","CLOSE","DEFAULT","cursorConfig","normal","add","close","move","PenObject","options","penType","stroke","fill","lineWidth","PenCircle","x","y","radius","keyPointIndex","handleName","type","PenLine","x1","y1","x2","y2","KeyPoint","point","pointType","relationPoints","controller1","controller2","auxLine1","auxLine2","Pen","canvasId","circle","line","pathColor","pathFillColor","isFillPath","console","error","canvas","document","getElementById","canvasCtx","getContext","_mouseDown","_mouseMove","_mouseUp","_keydown","_mouseDblclick","message","penModeOn","setCursor","currentKeyPointIndex","isEdit","refreshEditPath","pathRealObject","auxPointAndLines","objects","filter","object","removeObjects","refreshRender","style","cursor","CURSOR_CONFIG","addEventListener","_penMouseDown","event","penMouseDown","_penMouseMove","_penMouseUp","target","_getMouseOverTarget","changeKeyPointType","offsetX","offsetY","path","Path2D","realPathStr","isInPath","isPointInPath","generateEditablePath","setAttribute","keyCode","exitPenMode","index","mousedownTarget","keyPointDataCache","penMouseMoveFix","_matchObjectsByProrerty","keyPointData","length","closeState","setMousedownOrigin","keyPoint","preKeyPoint","preLeft","preTop","addCanvasObjects","push","keyPointState","Math","abs","changeKeyPointPos","prev","prevLeft","prevTop","JSON","parse","stringify","cacheCloseState","altKey","penMouseDownOrigin","curKeyPoint","originPoint","createPathCurveAux","minulsX","minulsY","updatePenPathControll","nextItem","originX","originY","circle1","circle2","line1","line2","item","position","origin","isCashed","pathStr","_generatePathStr","fillColor","pathObjects","Infinity","forEach","pathSection","str","value","firstKeyPoint","lastkeyPoint","clearRect","width","height","_bringToFront","drawObjects","drawCircle","drawLine","drawPath","fillStyle","strokeStyle","beginPath","arc","PI","moveTo","lineTo","removeSingleObject","i","splice","sort","a","b","_containsPoint","slope","slope2","isPointInStroke","key","callback","curPoint","typelist","preItem","preX","preY","nextX","nextY","radian","hypotenuse","atan2","sqrt","pow","round","cos","sin","generateAuxPointLine"],"mappings":"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"}